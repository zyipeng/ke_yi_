<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.1.1',
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: true,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="KE_YI_">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="KE_YI_">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="KE_YI_">





  
  
  <link rel="canonical" href="http://yoursite.com/page/7/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>KE_YI_</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">KE_YI_</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-commonweal">

    
    
    
      
    

    

    <a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>公益 404</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/25/树状数组解决区间更新单点查询----hdu 1556 Color the ball/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ke_yi_">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/ke_yi_head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KE_YI_">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/25/树状数组解决区间更新单点查询----hdu 1556 Color the ball/" class="post-title-link" itemprop="url">树状数组解决区间更新单点查询----hdu 1556 Color the ball</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-25 10:28:58" itemprop="dateCreated datePublished" datetime="2018-07-25T10:28:58+08:00">2018-07-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-09 15:39:36" itemprop="dateModified" datetime="2019-05-09T15:39:36+08:00">2019-05-09</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>   题目详情： </p>
<h1 id="Color-the-ball"><a href="#Color-the-ball" class="headerlink" title="Color the ball"></a>Color the ball</h1><p> <strong><strong>Time Limit: 9000/3000 MS (Java/Others) Memory Limit: 32768/32768 K (Java/Others)<br> Total Submission(s): 26931 Accepted Submission(s): 13049</strong></strong></p>
<p> <strong>Problem Description</strong></p>
<p> N个气球排成一排，从左到右依次编号为1,2,3….N.每次给定2个整数a b(a &lt;= b),lele便为骑上他的“小飞鸽”牌电动车从气球a开始到气球b依次给每个气球涂一次颜色。但是N次以后lele已经忘记了第I个气球已经涂过几次颜色了，你能帮他算出每个气球被涂过几次颜色吗？</p>
<p> <strong>Input</strong></p>
<p> 每个测试实例第一行为一个整数N,(N &lt;= 100000).接下来的N行，每行包括2个整数a b(1 &lt;= a &lt;= b &lt;= N)。<br> 当N = 0，输入结束。</p>
<p> <strong>Output</strong></p>
<p> 每个测试实例输出一行，包括N个整数，第I个数代表第I个气球总共被涂色的次数。</p>
<p> <strong>Sample Input</strong></p>
<p> 3<br> 1 1<br> 2 2<br> 3 3<br> 3<br> 1 1<br> 1 2<br> 1 3<br> 0</p>
<p> <strong>Sample Output</strong></p>
<p> 1 1 1<br> 3 2 1 </p>
<p> 题目分析：其实这个题目根本不需要用到树状数组，完全可以用简单的技巧解出来。代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> #include &quot;stdio.h&quot;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int n,i,l,s,r;</span><br><span class="line">    while(scanf(&quot;%d&quot;,&amp;n),n)</span><br><span class="line">    &#123;</span><br><span class="line">        int c[100001]=&#123;0&#125;;</span><br><span class="line">        i=n;</span><br><span class="line">		s=0;</span><br><span class="line">        while(i--)</span><br><span class="line">        &#123;</span><br><span class="line">            scanf(&quot;%d %d&quot;,&amp;l,&amp;r);</span><br><span class="line">            c[l]++;</span><br><span class="line">			c[r+1]--;</span><br><span class="line">        &#125;</span><br><span class="line">        for(i=1;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            s+=c[i];</span><br><span class="line">            printf(&quot;%d &quot;,s);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;%d\n&quot;,s+c[n]);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 虽然能这样解，但是下次遇到不是查询所有点而是查询，更新一次查询一次，并且查询不是连续的就不能直接这样了。树状数组是这样的，因为我们要求的是每一个点的和所以只要将更新区间的c[l]加上增量然后c[r+1]减去增量就可以了。如下图</p>
<p> <img src="https://img-blog.csdn.net/20180725101338392?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2tlX3lpXw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p> 为什么会有这样的效果呢，每一次更新都会将后面+=lowbit（）的下标更新,c[i]+add后面相应的位置都会+add，然后再c[j]-add,后面的相应位置都会-add。</p>
<p> 下面是树状数组的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"> #include&lt;cstdio&gt;</span><br><span class="line">#include&lt;cstring&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">const int MAXN=1e5+10;</span><br><span class="line">int s[MAXN];</span><br><span class="line">int n;</span><br><span class="line">int lowbit(int x)&#123;return x&amp;(-x);&#125;</span><br><span class="line">int sum(int x)&#123;</span><br><span class="line">    int sum=0;</span><br><span class="line">    while(x)&#123;</span><br><span class="line">        sum+=s[x];</span><br><span class="line">        x-=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">    return sum;</span><br><span class="line">&#125;</span><br><span class="line">void add(int x)&#123;</span><br><span class="line">    while(x&lt;=MAXN)&#123;</span><br><span class="line">        s[x]++;</span><br><span class="line">        x+=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">void sub(int x)&#123;</span><br><span class="line">    while(x&lt;=MAXN)&#123;</span><br><span class="line">        s[x]--;</span><br><span class="line">        x+=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    int a,b;</span><br><span class="line">    while(~scanf(&quot;%d&quot;,&amp;n)&amp;&amp;n!=0)&#123;</span><br><span class="line">        memset(s,0,sizeof(s));</span><br><span class="line">        for(int i=1;i&lt;=n;i++)&#123;</span><br><span class="line">            scanf(&quot;%d%d&quot;,&amp;a,&amp;b);</span><br><span class="line">            add(a);//在做端点加</span><br><span class="line">            sub(b+1);//在有端点后面一个位置减</span><br><span class="line">        &#125;</span><br><span class="line">        for(int i=1;i&lt;=n;i++)&#123;</span><br><span class="line">            printf(&quot;%d&quot;,sum(i));</span><br><span class="line">            if(i!=n)printf(&quot; &quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/24/codeblocks调试问题--单步调试遇到breakpoint不停---不能单步调试--运行按钮是灰色但是没有dos窗口/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ke_yi_">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/ke_yi_head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KE_YI_">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/24/codeblocks调试问题--单步调试遇到breakpoint不停---不能单步调试--运行按钮是灰色但是没有dos窗口/" class="post-title-link" itemprop="url">codeblocks调试问题--单步调试遇到breakpoint不停---不能单步调试--运行按钮是灰色但是没有dos窗口</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-24 21:57:00" itemprop="dateCreated datePublished" datetime="2018-07-24T21:57:00+08:00">2018-07-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-09 15:39:37" itemprop="dateModified" datetime="2019-05-09T15:39:37+08:00">2019-05-09</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>   今天晚上调试的时候可能不小心改了设置，还是其它原因，codeblocks突然遇到breakpoint不停了，然后百度了一下，大部分是说project创建的问题，感觉和自己的问题不同，我的问题是所有的project都不能单步调试。然后在seting-&gt;debug设置中找了一会都没有找到相应的设置，然后我就到debug中找到了debug-&gt;active debuggers-&gt;gdb/cdb debugger:default,勾选之后发现可以调试了，然后决定用博客记录下来，希望能给遇到相似的问题的同学也能得到帮助。</p>
<p> <img src="https://img-blog.csdn.net/20180724213613828?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2tlX3lpXw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p> 以前刚用codeblocks编写程序的时候发现也不能但不单步调试，单步调试的时候提示下面一样的信息，其实下面的信息就是解决方法，下面大概意思就是没有但不调试的软件。 </p>
<p> <img src="https://img-blog.csdn.net/20180724214645342?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2tlX3lpXw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p> 点开setting-&gt;debugger</p>
<p> <img src="https://img-blog.csdn.net/20180724214849212?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2tlX3lpXw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p> <img src="https://img-blog.csdn.net/20180724215006382?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2tlX3lpXw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p> 上面的红色框中就是你要选择调试器的路径，点开选择路径，如果codeblocks软件是安装在C:\Program Files (x86)下面的话就是下面图片中所示的路径了，然后选择gdb32.exe，点击ok保存就可以调试了。（对了，还要选择上图中的GDB选项）</p>
<p> <img src="https://img-blog.csdn.net/20180724215122687?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2tlX3lpXw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p> 有时候调试器出错了，虽然你看不到程序的运行窗口，但是程序其实是在运行的。并且你是不可以再点击运行按钮运行程序的，这个时候就可以打开任务管理器，关闭相应的任务了，一般关闭想下图所示的那样的图标一样的任务就可以了。</p>
<p> <img src="https://img-blog.csdn.net/20180724214539638?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2tlX3lpXw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt> </p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/23/线段树+树状数组----hdoj 1166 敌兵布阵/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ke_yi_">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/ke_yi_head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KE_YI_">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/23/线段树+树状数组----hdoj 1166 敌兵布阵/" class="post-title-link" itemprop="url">线段树+树状数组----hdoj 1166 敌兵布阵</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-23 09:34:47" itemprop="dateCreated datePublished" datetime="2018-07-23T09:34:47+08:00">2018-07-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-09 15:39:38" itemprop="dateModified" datetime="2019-05-09T15:39:38+08:00">2019-05-09</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>   题目描述：</p>
<h1 id="敌兵布阵"><a href="#敌兵布阵" class="headerlink" title="敌兵布阵"></a>敌兵布阵</h1><p> <strong><strong>Time Limit: 2000/1000 MS (Java/Others) Memory Limit: 65536/32768 K (Java/Others)<br> Total Submission(s): 117851 Accepted Submission(s): 49318</strong></strong></p>
<p> <strong>Problem Description</strong></p>
<p> C国的死对头A国这段时间正在进行军事演习，所以C国间谍头子Derek和他手下Tidy又开始忙乎了。A国在海岸线沿直线布置了N个工兵营地,Derek和Tidy的任务就是要监视这些工兵营地的活动情况。由于采取了某种先进的监测手段，所以每个工兵营地的人数C国都掌握的一清二楚,每个工兵营地的人数都有可能发生变动，可能增加或减少若干人手,但这些都逃不过C国的监视。<br> 中央情报局要研究敌人究竟演习什么战术,所以Tidy要随时向Derek汇报某一段连续的工兵营地一共有多少人,例如Derek问:“Tidy,马上汇报第3个营地到第10个营地共有多少人!”Tidy就要马上开始计算这一段的总人数并汇报。但敌兵营地的人数经常变动，而Derek每次询问的段都不一样，所以Tidy不得不每次都一个一个营地的去数，很快就精疲力尽了，Derek对Tidy的计算速度越来越不满:”你个死肥仔，算得这么慢，我炒你鱿鱼!”Tidy想：“你自己来算算看，这可真是一项累人的工作!我恨不得你炒我鱿鱼呢!”无奈之下，Tidy只好打电话向计算机专家Windbreaker求救,Windbreaker说：“死肥仔，叫你平时做多点acm题和看多点算法书，现在尝到苦果了吧!”Tidy说：”我知错了。。。”但Windbreaker已经挂掉电话了。Tidy很苦恼，这么算他真的会崩溃的，聪明的读者，你能写个程序帮他完成这项工作吗？不过如果你的程序效率不够高的话，Tidy还是会受到Derek的责骂的.</p>
<p> <strong>Input</strong></p>
<p> 第一行一个整数T，表示有T组数据。<br> 每组数据第一行一个正整数N（N&lt;=50000）,表示敌人有N个工兵营地，接下来有N个正整数,第i个正整数ai代表第i个工兵营地里开始时有ai个人（1&lt;=ai&lt;=50）。<br> 接下来每行有一条命令，命令有4种形式：<br> (1) Add i j,i和j为正整数,表示第i个营地增加j个人（j不超过30）<br> (2)Sub i j ,i和j为正整数,表示第i个营地减少j个人（j不超过30）;<br> (3)Query i j ,i和j为正整数,i&lt;=j，表示询问第i到第j个营地的总人数;<br> (4)End 表示结束，这条命令在每组数据最后出现;<br> 每组数据最多有40000条命令</p>
<p> <strong>Output</strong></p>
<p> 对第i组数据,首先输出“Case i:”和回车,<br> 对于每个Query询问，输出一个整数并回车,表示询问的段中的总人数,这个数保持在int以内。</p>
<p> <strong>Sample Input</strong></p>
<p> 1<br> 10<br> 1 2 3 4 5 6 7 8 9 10<br> Query 1 3<br> Add 3 6<br> Query 2 7<br> Sub 10 2<br> Add 6 3<br> Query 3 10<br> End</p>
<p> <strong>Sample Output</strong></p>
<p> Case 1:<br> 6<br> 33<br> 59</p>
<p> 题目分析：单点更新，求区间和，即可以用树状数组模板解决，也可以用线段树模板解决。</p>
<p> 树状数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"> #include&lt;cstdio&gt;</span><br><span class="line">#include&lt;cstring&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">const int maxn=50005;</span><br><span class="line">int d[maxn];//记录前缀和</span><br><span class="line">int lowbit(int x)&#123;return x&amp;(-x);&#125;</span><br><span class="line">int Queries(int x,int y)//查询</span><br><span class="line">&#123;</span><br><span class="line">    int sumx,sumy;</span><br><span class="line">    sumx=sumy=0;</span><br><span class="line">    while(x)</span><br><span class="line">    &#123;</span><br><span class="line">        sumx+=d[x];</span><br><span class="line">        x-=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">    while(y)</span><br><span class="line">    &#123;</span><br><span class="line">        sumy+=d[y];</span><br><span class="line">        y-=lowbit(y);</span><br><span class="line">    &#125;</span><br><span class="line">    return sumy-sumx;</span><br><span class="line">&#125;</span><br><span class="line">void add(int x,int v)//更新</span><br><span class="line">&#123;</span><br><span class="line">    while(x&lt;maxn)</span><br><span class="line">    &#123;</span><br><span class="line">        d[x]+=v;</span><br><span class="line">        x+=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int T,i,x,y,v,n;</span><br><span class="line">    char order[10];</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;T);</span><br><span class="line">    i=1;</span><br><span class="line">    while(i&lt;=T)</span><br><span class="line">    &#123;</span><br><span class="line">        memset(d,0,sizeof(d));</span><br><span class="line">        scanf(&quot;%d&quot;,&amp;n);</span><br><span class="line">        for(int j=1;j&lt;=n;j++)</span><br><span class="line">        &#123;</span><br><span class="line">            scanf(&quot;%d&quot;,&amp;v);</span><br><span class="line">            add(j,v);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;Case %d:\n&quot;,i++);</span><br><span class="line">        while(true)</span><br><span class="line">        &#123;</span><br><span class="line">            scanf(&quot;%s&quot;,order);</span><br><span class="line">            if(order[0]==&apos;A&apos;)</span><br><span class="line">            &#123;</span><br><span class="line">                scanf(&quot;%d%d&quot;,&amp;x,&amp;v);</span><br><span class="line">                add(x,v);</span><br><span class="line">            &#125;</span><br><span class="line">            else if(order[0]==&apos;S&apos;)</span><br><span class="line">            &#123;</span><br><span class="line">                scanf(&quot;%d%d&quot;,&amp;x,&amp;v);</span><br><span class="line">                add(x,-v);</span><br><span class="line">            &#125;</span><br><span class="line">            else if(order[0]==&apos;Q&apos;)</span><br><span class="line">            &#123;</span><br><span class="line">                scanf(&quot;%d%d&quot;,&amp;x,&amp;y);</span><br><span class="line">                printf(&quot;%d\n&quot;,Queries(x-1,y));</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 线段树：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"> #include&lt;cstdio&gt;</span><br><span class="line">#include&lt;cmath&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">const int MAXNODE=1&lt;&lt;17;</span><br><span class="line">const int MAXN=50005;</span><br><span class="line"></span><br><span class="line">struct &#123;</span><br><span class="line">    int value,right,left;</span><br><span class="line">&#125;node[MAXNODE];</span><br><span class="line">int father[MAXN];</span><br><span class="line">void BuildTree(int i,int left,int right)&#123;</span><br><span class="line">    node[i].left = left;</span><br><span class="line">    node[i].right = right;</span><br><span class="line">    node[i].value = 0;</span><br><span class="line">    if(left==right)&#123;</span><br><span class="line">        father[left] = i;</span><br><span class="line">        return ;</span><br><span class="line">    &#125;</span><br><span class="line">    BuildTree(i&lt;&lt;1,left,(int) floor((right+left)/2.0));</span><br><span class="line">    BuildTree((i&lt;&lt;1)+1,(int) floor((right+left)/2.0+1),right);</span><br><span class="line">&#125;</span><br><span class="line">void UpdateTree(int ni,int add)&#123;</span><br><span class="line">    node[ni].value+=add;</span><br><span class="line">    if(ni==1) return ;</span><br><span class="line">    UpdateTree(ni/2,add);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int Sum;</span><br><span class="line">void Query(int i,int left,int right)</span><br><span class="line">&#123;</span><br><span class="line">    if(node[i].left==left&amp;&amp;node[i].right==right)&#123;</span><br><span class="line">        Sum+=node[i].value;</span><br><span class="line">        return ;</span><br><span class="line">    &#125;</span><br><span class="line">    i=i&lt;&lt;1;</span><br><span class="line">    if(left&lt;=node[i].right)&#123;</span><br><span class="line">        if(right&lt;=node[i].right)Query(i,left,right);</span><br><span class="line">        else Query(i,left,node[i].right);</span><br><span class="line">    &#125;</span><br><span class="line">    i++;</span><br><span class="line">    if(right&gt;=node[i].left)&#123;</span><br><span class="line">        if(left&gt;=node[i].left)Query(i,left,right);</span><br><span class="line">        else Query(i,node[i].left,right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">    int T,n;</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;T);</span><br><span class="line">    int i,j=1,d;</span><br><span class="line">    while(j&lt;=T)&#123;</span><br><span class="line">        scanf(&quot;%d&quot;,&amp;n);</span><br><span class="line">        BuildTree(1,1,n);</span><br><span class="line">        for(i=1;i&lt;=n;i++)&#123;</span><br><span class="line">            scanf(&quot;%d&quot;,&amp;d);</span><br><span class="line">            UpdateTree(father[i],d);</span><br><span class="line">        &#125;</span><br><span class="line">        char par[6];</span><br><span class="line">        int a,b;</span><br><span class="line">        printf(&quot;Case %d:\n&quot;,j++);</span><br><span class="line">        while(~scanf(&quot;%s&quot;,par)&amp;&amp;par[0]!=&apos;E&apos;)&#123;</span><br><span class="line">            scanf(&quot;%d%d&quot;,&amp;a,&amp;b);</span><br><span class="line">            if(par[0]==&apos;Q&apos;)&#123;</span><br><span class="line">                Sum=0;</span><br><span class="line">                Query(1,a,b);</span><br><span class="line">                printf(&quot;%d\n&quot;,Sum);</span><br><span class="line">            &#125;</span><br><span class="line">            else if(par[0]==&apos;A&apos;)&#123;</span><br><span class="line">                UpdateTree(father[a],b);</span><br><span class="line">            &#125;</span><br><span class="line">            else if(par[0]==&apos;S&apos;)&#123;</span><br><span class="line">                UpdateTree(father[a],-b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/23/线段树----hdoj 1754 I here it/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ke_yi_">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/ke_yi_head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KE_YI_">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/23/线段树----hdoj 1754 I here it/" class="post-title-link" itemprop="url">线段树----hdoj 1754 I here it</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-23 09:22:41" itemprop="dateCreated datePublished" datetime="2018-07-23T09:22:41+08:00">2018-07-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-09 15:39:39" itemprop="dateModified" datetime="2019-05-09T15:39:39+08:00">2019-05-09</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>   题目表述：</p>
<h1 id="I-Hate-It"><a href="#I-Hate-It" class="headerlink" title="I Hate It"></a>I Hate It</h1><p> <strong><strong>Time Limit: 9000/3000 MS (Java/Others) Memory Limit: 32768/32768 K (Java/Others)<br> Total Submission(s): 96882 Accepted Submission(s): 36592</strong></strong></p>
<p> <strong>Problem Description</strong></p>
<p> 很多学校流行一种比较的习惯。老师们很喜欢询问，从某某到某某当中，分数最高的是多少。<br> 这让很多学生很反感。<br> 不管你喜不喜欢，现在需要你做的是，就是按照老师的要求，写一个程序，模拟老师的询问。当然，老师有时候需要更新某位同学的成绩。</p>
<p> <strong>Input</strong></p>
<p> 本题目包含多组测试，请处理到文件结束。<br> 在每个测试的第一行，有两个正整数 N 和 M ( 0&lt;N&lt;=200000,0&lt;M&lt;5000 )，分别代表学生的数目和操作的数目。<br> 学生ID编号分别从1编到N。<br> 第二行包含N个整数，代表这N个学生的初始成绩，其中第i个数代表ID为i的学生的成绩。<br> 接下来有M行。每一行有一个字符 C (只取’Q’或’U’) ，和两个正整数A，B。<br> 当C为’Q’的时候，表示这是一条询问操作，它询问ID从A到B(包括A,B)的学生当中，成绩最高的是多少。<br> 当C为’U’的时候，表示这是一条更新操作，要求把ID为A的学生的成绩更改为B。</p>
<p> <strong>Output</strong></p>
<p> 对于每一次询问操作，在一行里面输出最高成绩。</p>
<p> <strong>Sample Input</strong></p>
<p> 5<br> 6 1 2 3 4 5<br> Q 1 5<br> U 3 6<br> Q 3 4<br> Q 4 5<br> U 2 9<br> Q 1 5</p>
<p> <strong>Sample Output</strong></p>
<p> 5<br> 6<br> 5<br> 9</p>
<p> 题目分析： 因为学生的成绩的动态更新的，并且是区间查询，求区间的最大值。这是一个很明显的线段树的题目，线段树记录每一段区间的最大值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"> #include&lt;cstdio&gt;</span><br><span class="line">#include&lt;algorithm&gt;</span><br><span class="line">#include&lt;cmath&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">const int  MAXN = 2e6+10;//学生的最大个数</span><br><span class="line">const int  MAXNODE = 1&lt;&lt;19;//线段树节点的最多个数</span><br><span class="line">//学生数量在最下层，我们可以根据满二叉树的性质计算所有节点的性质</span><br><span class="line">struct &#123;</span><br><span class="line">    int value,right,left;//value记录区间的最大值</span><br><span class="line">&#125;node[MAXNODE];</span><br><span class="line">int father[MAXN];//记录节点在二叉树中的位置</span><br><span class="line">void BuildTree(int i,int left,int right)&#123;//建树，将树所有节点初始化为0，得到father的数据</span><br><span class="line">    node[i].left = left;</span><br><span class="line">    node[i].right = right;</span><br><span class="line">    node[i].value = 0;</span><br><span class="line">    if(left==right)&#123;</span><br><span class="line">        father[left] = i;</span><br><span class="line">        return ;</span><br><span class="line">    &#125;</span><br><span class="line">    BuildTree(i&lt;&lt;1,left,(int) floor((right+left)/2.0));//建左数</span><br><span class="line">    BuildTree((i&lt;&lt;1)+1,(int) floor((right+left)/2.0+1),right);//建右树</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void UpdateTree(int ni)&#123;//更新树</span><br><span class="line">    if(ni==1)return ;</span><br><span class="line">    int fni=ni/2;</span><br><span class="line">    int lv=node[fni&lt;&lt;1].value;</span><br><span class="line">    int rv=node[(fni&lt;&lt;1)+1].value;</span><br><span class="line">    node[fni].value=max(lv,rv);//得到左右孩子的最大值</span><br><span class="line">    UpdateTree(ni/2);//更新父亲</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int Max;</span><br><span class="line">void Query(int i,int left,int right)//从i位置开始查询(left,right)区间的的最大值</span><br><span class="line">&#123;</span><br><span class="line">    if(node[i].left==left&amp;&amp;node[i].right==right)&#123;//找到要查询的区间计算</span><br><span class="line">        Max = max(Max,node[i].value);</span><br><span class="line">        return ;</span><br><span class="line">    &#125;</span><br><span class="line">    i=i&lt;&lt;1;</span><br><span class="line">    if(left&lt;=node[i].right)&#123;//对左孩子查询</span><br><span class="line">        if(right&lt;=node[i].right)Query(i,left,right);</span><br><span class="line">        else Query(i,left,node[i].right);</span><br><span class="line">    &#125;</span><br><span class="line">    i++;</span><br><span class="line">    if(right&gt;=node[i].left)//对有孩子查询</span><br><span class="line">    &#123;</span><br><span class="line">        if(left&gt;=node[i].left)Query(i,left,right);</span><br><span class="line">        else Query(i,node[i].left,right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int n,m,i,g;</span><br><span class="line">    while(~scanf(&quot;%d%d&quot;,&amp;n,&amp;m))&#123;</span><br><span class="line">        BuildTree(1,1,n);//从1开始键树</span><br><span class="line">        for(i=1;i&lt;=n;i++)&#123;</span><br><span class="line">            scanf(&quot;%d&quot;,&amp;g);</span><br><span class="line">            node[father[i]].value=g;//更新叶子节点</span><br><span class="line">            UpdateTree(father[i]);//向上更新父亲节点</span><br><span class="line">        &#125;</span><br><span class="line">        char par[2];</span><br><span class="line">        int a,b;</span><br><span class="line">        while(m--)&#123;</span><br><span class="line">            scanf(&quot;%s&quot;,par);</span><br><span class="line">            scanf(&quot;%d%d&quot;,&amp;a,&amp;b);</span><br><span class="line">            if(par[0]==&apos;Q&apos;)&#123;</span><br><span class="line">                Max=0;</span><br><span class="line">                Query(1,a,b);//查询</span><br><span class="line">                printf(&quot;%d\n&quot;,Max);</span><br><span class="line">            &#125;</span><br><span class="line">            else&#123;</span><br><span class="line">                node[father[a]].value=b;//更新a学生的成绩</span><br><span class="line">                UpdateTree(father[a]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/21/莫队算法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ke_yi_">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/ke_yi_head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KE_YI_">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/21/莫队算法/" class="post-title-link" itemprop="url">莫队算法</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-21 10:04:44" itemprop="dateCreated datePublished" datetime="2018-07-21T10:04:44+08:00">2018-07-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-09 15:40:19" itemprop="dateModified" datetime="2019-05-09T15:40:19+08:00">2019-05-09</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>   莫队算法是一种解决区间问题的算法，是一种很优的暴力算法。</p>
<p> 莫队算法的基本思想是，知道一个区间[l,r]的一些信息，就可以在很短的时间内求出它的扩展区间的一些信息。</p>
<p> 算法讲解挺详细的链接<a href="https://wenku.baidu.com/view/18b86cdc763231126fdb114f.html?from=search" target="_blank" rel="noopener">点击跳转到百度文库pdf文档</a></p>
<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p> Given a sequence of integers a1, a2, …, an and q pairs of integers (l1, r1), (l2, r2), …, (lq, rq), find count(l1, r1), count(l2, r2), …, count(lq, rq) where count(i, j) is the number of different integers among a1, a2, …, ai, aj, aj + 1, …, an.</p>
<h2 id="输入描述"><a href="#输入描述" class="headerlink" title="输入描述:"></a>输入描述:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> The input consists of several test cases and is terminated by end-of-file.</span><br><span class="line">The first line of each test cases contains two integers n and q.</span><br><span class="line">The second line contains n integers a1, a2, ..., an.</span><br><span class="line">The i-th of the following q lines contains two integers li and ri.</span><br></pre></td></tr></table></figure>
<h2 id="输出描述"><a href="#输出描述" class="headerlink" title="输出描述:"></a>输出描述:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">For each test case, print q integers which denote the result.</span><br></pre></td></tr></table></figure>
<p> 示例1</p>
<h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h2><p> <a href>复制</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> 3 2</span><br><span class="line">1 2 1</span><br><span class="line">1 2</span><br><span class="line">1 3</span><br><span class="line">4 1</span><br><span class="line">1 2 3 4</span><br><span class="line">1 3</span><br></pre></td></tr></table></figure>
<h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><p> <a href>复制</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> 2</span><br><span class="line">1</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<h2 id="备注"><a href="#备注" class="headerlink" title="备注:"></a>备注:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> * 1 ≤ n, q ≤ 105</span><br><span class="line">* 1 ≤ ai ≤ n</span><br><span class="line">* 1 ≤ li, ri ≤ n</span><br><span class="line">* The number of test cases does not exceed 10.</span><br></pre></td></tr></table></figure>
<p> 题目意思是给定一个序列，输入下标（i，j)计算序列不包括区间（i，j）之后的不同数字的个数。</p>
<p> 首先用暴力求解：直接对于每一个样例进行去掉中间区间再进行遍历</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"> #include&lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">const int maxn=100005;</span><br><span class="line">int q,m;</span><br><span class="line">int s[maxn],rec[maxn],Ans[manx];</span><br><span class="line">struct Par&#123;int lef,rig&#125;par[maxn];</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">	int i,j;</span><br><span class="line">	while(scanf(&quot;%d%d&quot;,&amp;q,&amp;m)!=EOF)</span><br><span class="line">	&#123;</span><br><span class="line">		memset(Ans,0,sizeof(Ans));</span><br><span class="line">		for(i=0;i&lt;q;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			scanf(&quot;%d&quot;,&amp;s[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		for(i=0;i&lt;m;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			scanf(&quot;%d%d&quot;,&amp;par[i].lef,&amp;par[i].rig);</span><br><span class="line">		&#125;</span><br><span class="line">		for(i=0;i&lt;m;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			memset(rec,0,sizoef(rec));</span><br><span class="line">			for(j=0;j&lt;par[i].lef;j++)</span><br><span class="line">			&#123;</span><br><span class="line">				if(rec[j]==0)</span><br><span class="line">					Ans[i]++;</span><br><span class="line">				rec[j]=1;</span><br><span class="line">			&#125;</span><br><span class="line">			for(j=par[i].rig;j++)</span><br><span class="line">			&#123;</span><br><span class="line">				if(rec[j]==0)</span><br><span class="line">					Ans[i]++;</span><br><span class="line">				rec[j]=1;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		for(j=0;j&lt;m;j++)</span><br><span class="line">			printf(&quot;%d\n&quot;,Ans[j]);</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 提交的结果是运行超时。</p>
<p> 莫队算法，同样是暴力但是它是根据知道了区间O(1)的时间去求它旁边的区间。</p>
<p> 其算法思路是这样的，先将n个元素的序列分成sqrt（n）组，然后对查询区间先根据左端点所在的组排序，然后再根据右端点排序，再进行查询，每一次查询都使用前面得到的查询结果进行更新。</p>
<p> 下面代码的思路是：先对整个序列进项查询，记录不同数组的总数，然后减去莫队算法得到的中间区间的总数，但是提交还是超时的，不过可以看出时间复杂度要比之前的暴力要更少。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"> #include&lt;algorithm&gt;</span><br><span class="line">#include&lt;cstring&gt;</span><br><span class="line">#include&lt;cstdio&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">const int maxn=100005;</span><br><span class="line">int q,m;</span><br><span class="line">int s[maxn],rec[maxn],md[maxn],Ans[maxn];</span><br><span class="line">struct Par&#123;int lef,rig,id;&#125;par[maxn];</span><br><span class="line">bool cmp(Par a,Par b)</span><br><span class="line">&#123;</span><br><span class="line">    if(md[a.lef]!=md[b.lef])return a.lef&lt;b.lef;</span><br><span class="line">    return a.rig&lt;b.rig;</span><br><span class="line">&#125;</span><br><span class="line">void solve()</span><br><span class="line">&#123;</span><br><span class="line">    int i,lef=1,rig=1,ans=0;</span><br><span class="line">    for(i=1;i&lt;=m;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        while(lef&lt;par[i].lef)</span><br><span class="line">            if(--rec[s[lef++]]==0)</span><br><span class="line">                ans--;</span><br><span class="line">        while(lef&gt;par[i].lef)</span><br><span class="line">            if(rec[s[--lef]]++==0)</span><br><span class="line">                ans++;</span><br><span class="line">        while(rig&lt;par[i].rig)</span><br><span class="line">            if(rec[s[++rig]]++==0)</span><br><span class="line">                ans++;</span><br><span class="line">        while(rig&gt;par[i].rig)</span><br><span class="line">            if(--rec[s[rig--]]==0)</span><br><span class="line">                ans--;</span><br><span class="line">        Ans[par[i].id]=ans;</span><br><span class="line">    &#125;</span><br><span class="line">    return ;</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int i,temp,total;</span><br><span class="line">    while(scanf(&quot;%d%d&quot;,&amp;q,&amp;m)!=EOF)</span><br><span class="line">    &#123;</span><br><span class="line">        memset(rec,0,sizeof(rec));</span><br><span class="line">        temp=sqrt(q);</span><br><span class="line">        total=0;</span><br><span class="line">        for(i=1;i&lt;=q;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            scanf(&quot;%d&quot;,&amp;s[i]);</span><br><span class="line">            md[i]=(i-1)/temp+1;</span><br><span class="line">            if(rec[s[i]]==0)</span><br><span class="line">            &#123;</span><br><span class="line">                total++;</span><br><span class="line">                rec[s[i]]=1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        for(i=1;i&lt;=m;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            scanf(&quot;%d%d&quot;,&amp;par[i].lef,&amp;par[i].rig);</span><br><span class="line">            par[i].lef++;</span><br><span class="line">            par[i].rig--;</span><br><span class="line">            par[i].id=i;</span><br><span class="line">        &#125;</span><br><span class="line">        sort(par+1,par+m+1,cmp);</span><br><span class="line">        memset(rec,0,sizeof(rec));</span><br><span class="line">        solve();</span><br><span class="line">        for(i=1;i&lt;=m;i++)printf(&quot;%d\n&quot;,total-Ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 下面的代码是优化后的莫队排序，通过直接计算两边区间的总数得到答案。提交时通过的，但是运行的时间和时间限制很接近，所以莫队算法并不是解这道题的最优算法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"> #include&lt;algorithm&gt;</span><br><span class="line">#include&lt;cstring&gt;</span><br><span class="line">#include&lt;cstdio&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">const int maxn=100005;</span><br><span class="line">int q,m;</span><br><span class="line">int s[maxn],rec[maxn],md[maxn],Ans[maxn];</span><br><span class="line">struct Par&#123;int lef,rig,id;&#125;par[maxn];</span><br><span class="line">bool cmp(Par a,Par b)</span><br><span class="line">&#123;</span><br><span class="line">    if(md[a.lef]!=md[b.lef])return a.lef&lt;b.lef;</span><br><span class="line">    return a.rig&lt;b.rig;</span><br><span class="line">&#125;</span><br><span class="line">void solve()</span><br><span class="line">&#123;</span><br><span class="line">    int i,lef=0,rig=q+1,ans=0;</span><br><span class="line">    for(i=1;i&lt;=m;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        while(rig&lt;par[i].rig)</span><br><span class="line">        &#123;</span><br><span class="line">            rec[s[rig]]--;</span><br><span class="line">            if(rec[s[rig]]==0)</span><br><span class="line">                ans--;</span><br><span class="line">            rig++;</span><br><span class="line">        &#125;</span><br><span class="line">        while(rig&gt;par[i].rig)</span><br><span class="line">        &#123;</span><br><span class="line">            rig--;</span><br><span class="line">            if(rec[s[rig]]==0)</span><br><span class="line">                ans++;</span><br><span class="line">            rec[s[rig]]++;</span><br><span class="line">        &#125;</span><br><span class="line">        while(lef&lt;par[i].lef)</span><br><span class="line">        &#123;</span><br><span class="line">            lef++;</span><br><span class="line">            if(rec[s[lef]]==0)</span><br><span class="line">                ans++;</span><br><span class="line">            rec[s[lef]]++;</span><br><span class="line">        &#125;</span><br><span class="line">        while(lef&gt;par[i].lef)</span><br><span class="line">        &#123;</span><br><span class="line">            rec[s[lef]]--;</span><br><span class="line">            if(rec[s[lef]]==0)</span><br><span class="line">                ans--;</span><br><span class="line">            lef--;</span><br><span class="line">        &#125;</span><br><span class="line">        Ans[par[i].id]=ans;</span><br><span class="line">    &#125;</span><br><span class="line">    return ;</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int i,temp;</span><br><span class="line">    while(scanf(&quot;%d%d&quot;,&amp;q,&amp;m)!=EOF)</span><br><span class="line">    &#123;</span><br><span class="line">        memset(rec,0,sizeof(rec));</span><br><span class="line">        memset(Ans,0,sizeof(Ans));</span><br><span class="line">        temp=sqrt(q);</span><br><span class="line">        for(i=1;i&lt;=q;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            scanf(&quot;%d&quot;,&amp;s[i]);</span><br><span class="line">            md[i]=(i-1)/temp+1;</span><br><span class="line">        &#125;</span><br><span class="line">        for(i=1;i&lt;=m;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            scanf(&quot;%d%d&quot;,&amp;par[i].lef,&amp;par[i].rig);</span><br><span class="line">            par[i].id=i;</span><br><span class="line">        &#125;</span><br><span class="line">        sort(par+1,par+m+1,cmp);</span><br><span class="line">        solve();</span><br><span class="line">        for(i=1;i&lt;=m;i++)printf(&quot;%d\n&quot;,Ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/05/GetModuleFileName函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ke_yi_">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/ke_yi_head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KE_YI_">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/05/GetModuleFileName函数/" class="post-title-link" itemprop="url">GetModuleFileName函数</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-05 21:28:17" itemprop="dateCreated datePublished" datetime="2018-07-05T21:28:17+08:00">2018-07-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-09 15:40:29" itemprop="dateModified" datetime="2019-05-09T15:40:29+08:00">2019-05-09</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>   GetModuleFileName函数检索指定模块的完全限定路径。</p>
<p>要指定包含模块的进程，请使用GetModuleFileNameEx函数。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**DWORD GetModuleFileName( HMODULE**_ [hModule]()_**, **// handle to module ** LPTSTR**_ [lpFilename]()_**, **// path buffer ** DWORD**_ [nSize]()_ // size of buffer **);**</span><br></pre></td></tr></table></figure>
<p>参数</p>
<p>hModule:[in]请求路径的模块的句柄。如果该参数为空，GetModuleFileName将检索当前模块的路径。</p>
<p>lpFilename:[out]指向缓冲区的指针，该缓冲区接收模块的完全限定路径。如果字符串的长度超过了nSize参数指定的大小，则该字符串将被截断。  </p>
<p>Windows NT/2000/XP:路径可以有前缀“\?”基于加载模块的方式。有关更多信息，请参见文件名称约定。nSize:[in]在TCHARs中指定lpFilename缓冲区的长度。</p>
<p>返回值  </p>
<p>如果函数成功，返回值是在TCHARs中复制到缓冲区的字符串的长度。如果函数失败，返回值为0。要获得扩展错误信息，请调用GetLastError。</p>
<p>示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">	char regname[]=&quot;Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run&quot;;</span><br><span class="line">	HKEY hkResult;</span><br><span class="line">	int ret;</span><br><span class="line">	ret=RegOpenKey(HKEY_CURRENT_USER,regname,&amp;hkResult);</span><br><span class="line"></span><br><span class="line">	ret=RegSetValueEx(hkResult,&quot;door&quot;,0,REG_EXPAND_SZ,(unsigned char *)&quot;%systemroot%\\door.exe&quot;,25);</span><br><span class="line"></span><br><span class="line">	if(ret==0)</span><br><span class="line">	&#123;</span><br><span class="line">		printf(&quot;success to write run key\n&quot;);</span><br><span class="line">		RegCloseKey(hkResult);</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		printf(&quot;failed to open regedit.%d\n&quot;,ret);</span><br><span class="line">		RegCloseKey(hkResult);</span><br><span class="line">	&#125;</span><br><span class="line">	char modlepath[256];</span><br><span class="line">	char syspath[256];</span><br><span class="line">	GetModuleFileName(0,modlepath,256);//获取当前执行模块所在路径</span><br><span class="line"></span><br><span class="line">	GetSystemDirectory(syspath,256);</span><br><span class="line">	ret=CopyFile(modlepath,strcat(syspath,&quot;\\door.exe&quot;),1);</span><br><span class="line">	if(ret)</span><br><span class="line">		printf(&quot;%s has been copyed to sys dir %s\n&quot;,modlepath,syspath);</span><br><span class="line">	else</span><br><span class="line">		printf(&quot;%s is exisis&quot;,modlepath);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/05/RegQueryValueEx函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ke_yi_">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/ke_yi_head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KE_YI_">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/05/RegQueryValueEx函数/" class="post-title-link" itemprop="url">RegQueryValueEx函数</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-05 17:59:30" itemprop="dateCreated datePublished" datetime="2018-07-05T17:59:30+08:00">2018-07-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-09 15:40:31" itemprop="dateModified" datetime="2019-05-09T15:40:31+08:00">2019-05-09</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>   RegQueryValueEx函数检索与开放注册表键关联的指定值名称的类型和数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**LONG RegQueryValueEx( HKEY**_ [hKey]()_**, **// handle to key ** LPCTSTR**_ [lpValueName]()_**, **// value name ** LPDWORD**_ [lpReserved]()_**, **// reserved ** LPDWORD**_ [lpType]()_**, **// type buffer ** LPBYTE**_ [lpData]()_**, **// data buffer ** LPDWORD**_ [lpcbData]()_ // size of data buffer **);**</span><br></pre></td></tr></table></figure>
<p>参数</p>
<p>hKey：当前打开的密钥或以下预定义密钥之一的句柄:</p>
<p><strong>HKEY_CLASSES_ROOT<br>HKEY_CURRENT_CONFIG<br>HKEY_CURRENT_USER<br>HKEY_LOCAL_MACHINE<br>HKEY_USERS<br>Windows NT/2000/XP: HKEY_PERFORMANCE_DATA<br>Windows XP: HKEY_PERFORMANCE_TEXT<br>HKEY_PERFORMANCE_NLSTEXT<br>Windows 95/98/Me: HKEY_DYN_DATA</strong></p>
<p>lpValueName：指向一个以null结尾的字符串的指针，该字符串包含要查询的值的名称。如果lpValueName是NULL或空字符串“”，函数将检索键的未命名或默认值(如果有的话)的类型和数据。</p>
<p>Windows 95/98/Me:每个键都有一个默认值，最初不包含数据。在Windows 95上，默认值类型总是REG_SZ。在Windows 98上，键的默认值的类型最初是REG_SZ，但是RegSetValueEx可以指定具有不同类型的默认值。</p>
<p>Windows NT/2000/XP:键不自动具有未命名或默认值。未命名值可以是任何类型。  </p>
<p>lpReserved：保留;必须为NULL。</p>
<p>lpType：指向一个变量的指针，该变量接收指示存储在指定值中的数据类型的代码。有关可能的类型代码的列表，请参见注册表值类型。如果不需要类型代码，则lpType参数可以为NULL。</p>
<p>lpData：指向接收该值数据的缓冲区的指针。如果不需要数据，此参数可以为空。</p>
<p>lpcbData：指向一个变量的指针，该变量指定lpData参数指向的缓冲区的大小(以字节为单位)。当函数返回时，该变量包含复制到lpData的数据的大小。  </p>
<p>如果数据具有REG_SZ、REG_MULTI_SZ或REG_EXPAND_SZ类型，那么lpcbData也将包含终止null字符或字符的大小。  </p>
<p>只有当lpData为空时，lpcbData参数才可以为NULL。如果lpData参数指定的缓冲区不够大，无法容纳数据，则函数返回值ERROR_MORE_DATA，并将所需的缓冲区大小(以字节为单位)存储到lpcbData指向的变量中。在这种情况下，lpValue缓冲区的内容没有定义。  </p>
<p>如果lpData是NULL，并且lpcbData是非NULL，那么函数将返回ERROR_SUCCESS，并在lpcbData指向的变量中存储数据的大小(以字节为单位)。这让应用程序确定为值的数据分配缓冲区的最佳方法。<br>如果hKey指定HKEY_PERFORMANCE_DATA，而lpData缓冲区太小，RegQueryValueEx返回ERROR_MORE_DATA，但是lpcbData不返回所需的缓冲区大小。这是因为性能数据的大小可以从一个调用更改为下一个调用。在这种情况下，您必须增加缓冲区大小并调用RegQueryValueEx，在lpcbData参数中再次传递更新的缓冲区大小。重复此操作，直到函数成功。您需要维护一个单独的变量来跟踪缓冲区大小，因为lpcbData返回的值是不可预测的。  </p>
<p>返回值  </p>
<p>如果函数成功，返回值为ERROR_SUCCESS。  </p>
<p>如果函数失败，返回值是Winerror.h中定义的非零错误代码。您可以使用FormatMessage函数和FORMAT_MESSAGE_FROM_SYSTEM标志来获得错误的通用描述。</p>
<p>示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;conio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line">	long lRet;</span><br><span class="line">	HKEY hKey;</span><br><span class="line">	TCHAR tchData[64];</span><br><span class="line">	DWORD dwSize;</span><br><span class="line">	lRet=RegOpenKeyEx(</span><br><span class="line">	HKEY_LOCAL_MACHINE,         // handle to open key</span><br><span class="line">	&quot;Hardware\\Description\\System\\CentralProcessor\\0&quot;,  // subkey name</span><br><span class="line">	0,   // reserved</span><br><span class="line">	KEY_QUERY_VALUE, // security access mask</span><br><span class="line">	&amp;hKey    // handle to open key</span><br><span class="line">	);</span><br><span class="line">	if(lRet==ERROR_SUCCESS)</span><br><span class="line">	&#123;</span><br><span class="line">		dwSize=sizeof(tchData);</span><br><span class="line">		lRet=RegQueryValueEx(</span><br><span class="line">		hKey,            // handle to key</span><br><span class="line">		&quot;ProcessorNameString&quot;,  // value name</span><br><span class="line">		NULL,   // reserved</span><br><span class="line">		NULL,       // type buffer</span><br><span class="line">		(LPBYTE)tchData,        // data buffer</span><br><span class="line">		&amp;dwSize      // size of data buffer</span><br><span class="line">		);</span><br><span class="line">		if(lRet==ERROR_SUCCESS)</span><br><span class="line">		&#123;</span><br><span class="line">			printf(&quot;\n CPU INFO:&quot;);</span><br><span class="line">			printf(&quot;%s\n&quot;,tchData);</span><br><span class="line">		&#125;</span><br><span class="line">		//以下是失败的内容</span><br><span class="line">		else</span><br><span class="line">		&#123;</span><br><span class="line">			printf(&quot;\nCPU INFO:&quot;);</span><br><span class="line">			printf(&quot;UNKNOWN\n&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	//以下是打开失败</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		printf(&quot;\n CPU INFO:&quot;);</span><br><span class="line">		printf(&quot;UNKNOWN\n&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	RegCloseKey(hKey);</span><br><span class="line">	getch();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/05/RegOpenKeyEx函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ke_yi_">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/ke_yi_head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KE_YI_">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/05/RegOpenKeyEx函数/" class="post-title-link" itemprop="url">RegOpenKeyEx函数</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-05 17:48:58" itemprop="dateCreated datePublished" datetime="2018-07-05T17:48:58+08:00">2018-07-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-09 15:40:31" itemprop="dateModified" datetime="2019-05-09T15:40:31+08:00">2019-05-09</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>   RegOpenKeyEx函数打开指定的注册表项。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**LONG RegOpenKeyEx( HKEY**_ [hKey]()_**, **// handle to open key ** LPCTSTR**_ [lpSubKey]()_**, **// subkey name **DWORD** _[ulOptions]()_**,** // reserved ** REGSAM**_ [samDesired]()_**, **// security access mask ** PHKEY**_ [phkResult]()_ // handle to open key **);**</span><br></pre></td></tr></table></figure>
<p>参数</p>
<p>hkey：当前打开的密钥或以下预定义密钥之一的句柄</p>
<p><strong>HKEY_CLASSES_ROOT<br>HKEY_CURRENT_CONFIG<br>HKEY_CURRENT_USER<br>HKEY_LOCAL_MACHINE<br>HKEY_USERS<br>Windows NT/2000/XP: HKEY_PERFORMANCE_DATA<br>Windows 95/98/Me: HKEY_DYN_DATA</strong></p>
<p>lpSubKey：指向一个空终止字符串的指针，该字符串包含要打开的子键的名称。如果该参数为NULL或指向空字符串的指针，则函数将为由hKey参数标识的键打开一个新句柄。在这种情况下，函数将不会关闭先前打开的句柄。</p>
<p>ulOptions：保留;必须是零。  </p>
<p>samDesired：一个访问掩码，它指定对密钥的期望访问权限。这个参数可以是以下值的组合。KEY_CREATE_LINK、KEY_CREATE_SUB_KEY、KEY_ENUMERATE_SUB_KEYS、KEY_EXECUTE、KEY_NOTIFY、KEY_QUERY_VALUE、KEY_SET_VALUE、KEY_ALL_ACCESS、KEY_READ、KEY_WOW64_64KEY、KEY_WOW64_32KEY、KEY_WRITE。</p>
<p>phkResult：指向变量的指针，该变量接收打开的键的句柄。当您不再需要返回的句柄时，请调用RegCloseKey函数来关闭它。</p>
<p>返回值  </p>
<p>如果函数成功，返回值为ERROR_SUCCESS。如果函数失败，返回值是Winerror.h中定义的非零错误代码。您可以使用FormatMessage函数和FORMAT_MESSAGE_FROM_SYSTEM标志来获得错误的通用描述。<br>示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;conio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line">	long lRet;</span><br><span class="line">	HKEY hKey;</span><br><span class="line">	TCHAR tchData[64];</span><br><span class="line">	DWORD dwSize;</span><br><span class="line">	lRet=RegOpenKeyEx(</span><br><span class="line">	HKEY_LOCAL_MACHINE,         // handle to open key</span><br><span class="line">	&quot;Hardware\\Description\\System\\CentralProcessor\\0&quot;,  // subkey name</span><br><span class="line">	0,   // reserved</span><br><span class="line">	KEY_QUERY_VALUE, // security access mask</span><br><span class="line">	&amp;hKey    // handle to open key</span><br><span class="line">	);</span><br><span class="line">	if(lRet==ERROR_SUCCESS)</span><br><span class="line">	&#123;</span><br><span class="line">		dwSize=sizeof(tchData);</span><br><span class="line">		lRet=RegQueryValueEx(</span><br><span class="line">		hKey,            // handle to key</span><br><span class="line">		&quot;ProcessorNameString&quot;,  // value name</span><br><span class="line">		NULL,   // reserved</span><br><span class="line">		NULL,       // type buffer</span><br><span class="line">		(LPBYTE)tchData,        // data buffer</span><br><span class="line">		&amp;dwSize      // size of data buffer</span><br><span class="line">		);</span><br><span class="line">		if(lRet==ERROR_SUCCESS)</span><br><span class="line">		&#123;</span><br><span class="line">			printf(&quot;\n CPU INFO:&quot;);</span><br><span class="line">			printf(&quot;%s\n&quot;,tchData);</span><br><span class="line">		&#125;</span><br><span class="line">		//以下是失败的内容</span><br><span class="line">		else</span><br><span class="line">		&#123;</span><br><span class="line">			printf(&quot;\nCPU INFO:&quot;);</span><br><span class="line">			printf(&quot;UNKNOWN\n&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	//以下是打开失败</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		printf(&quot;\n CPU INFO:&quot;);</span><br><span class="line">		printf(&quot;UNKNOWN\n&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	RegCloseKey(hKey);</span><br><span class="line">	getch();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/05/RegSetValueEx函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ke_yi_">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/ke_yi_head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KE_YI_">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/05/RegSetValueEx函数/" class="post-title-link" itemprop="url">RegSetValueEx函数</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-05 17:35:21" itemprop="dateCreated datePublished" datetime="2018-07-05T17:35:21+08:00">2018-07-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-09 15:40:32" itemprop="dateModified" datetime="2019-05-09T15:40:32+08:00">2019-05-09</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>   RegSetValueEx函数在注册表项下设置指定值的数据和类型。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**LONG RegSetValueEx( HKEY**_ [hKey]()_**, **// handle to key ** LPCTSTR**_ [lpValueName]()_**, **// value name **DWORD** _[Reserved]()_**,** // reserved ** DWORD**_ [dwType]()_**, **// value type ** CONST BYTE**_ _*****_[lpData]()_**, **// value data ** DWORD**_ [cbData]()_ // size of value data **);**</span><br></pre></td></tr></table></figure>
<p>参数</p>
<p>hkey： 当前打开的密钥或以下预定义密钥之一的句柄: </p>
<p><strong>HKEY_CLASSES_ROOT<br>HKEY_CURRENT_CONFIG<br>HKEY_CURRENT_USER<br>HKEY_LOCAL_MACHINE<br>HKEY_USERS<br>Windows NT/2000/XP: HKEY_PERFORMANCE_DATA<br>Windows 95/98/Me: HKEY_DYN_DATA</strong></p>
<p>lpValueName：指向一个字符串的指针，该字符串包含要设置的值的名称。如果键中不存在这个名称的值，函数将其添加到键中。如果lpValueName是NULL或空字符串””，函数将为键的未命名或默认值设置类型和数据。</p>
<p>Reserved：保留;必须是零。</p>
<p>dwType：指定由lpData参数指向的数据类型的代码。有关可能类型代码的列表，请参见注册表值类型。<img src="https://img-blog.csdn.net/20180705173320511?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2tlX3lpXw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p>Ipdata：指向一个缓冲区的指针，该缓冲区包含以指定值名存储的数据。对于基于字符串的数据类型，如REG_SZ，字符串必须为空终止。对于REG_MULTI_SZ数据类型，字符串必须以双null结尾。</p>
<p>cbData：指定lpData参数指向的信息的大小(以字节为单位)。如果数据类型为REG_SZ、REG_EXPAND_SZ或REG_MULTI_SZ，则cbData必须包括终止null字符或字符的大小。</p>
<p>返回值  </p>
<p>如果函数成功，返回值为ERROR_SUCCESS。如果函数失败，返回值是Winerror.h中定义的非零错误代码。您可以使用FormatMessage函数和FORMAT_MESSAGE_FROM_SYSTEM标志来获得错误的通用描述。<br>示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line">	//根键、子键名称和到子键的句柄</span><br><span class="line">	HKEY hRoot=HKEY_LOCAL_MACHINE;</span><br><span class="line">	char *szSubKey=&quot;Software\\Microsoft\\Windows\\CurrentVersion\\Run&quot;;</span><br><span class="line">	HKEY hKey;//打开指定子键</span><br><span class="line">	DWORD dwDisposition=REG_OPENED_EXISTING_KEY;</span><br><span class="line">	//如果不存在就创建</span><br><span class="line">	LONG lRet=RegCreateKeyEx(</span><br><span class="line">		hRoot,</span><br><span class="line">		szSubkey,</span><br><span class="line">		0,</span><br><span class="line">		NULL,</span><br><span class="line">		REG_OPTION_NON_VOLATILE,KEY_ALL_ACCESS,</span><br><span class="line">		NULL,</span><br><span class="line">		&amp;hKey,</span><br><span class="line">		&amp;dwDisposition</span><br><span class="line">		);</span><br><span class="line">	if(lRet!=ERROR_SUCCESS)</span><br><span class="line">		return;</span><br><span class="line">	//得到当前执行文件的文件名（包含路径）</span><br><span class="line">	char szModule[MAX_PATH];</span><br><span class="line">	GetModuleFileName(NULL,szModule,MAX_PATH);</span><br><span class="line">	//创建一个新的键值，设置键值数据为文件</span><br><span class="line">	lRet=RegSetValueEx(</span><br><span class="line">		hKey,</span><br><span class="line">		&quot;SelfRunDemo&quot;,</span><br><span class="line">		0,</span><br><span class="line">		REG_SZ,</span><br><span class="line">		(BYTE*)szModule,</span><br><span class="line">		strlen(szModule)</span><br><span class="line">		);</span><br><span class="line">	if(lRet==ERROR_SUCCESS)</span><br><span class="line">		printf(&quot;self run success\n&quot;);</span><br><span class="line">	//关闭子键句柄</span><br><span class="line">	RegCloseKey(hKey);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/05/RegCreateKeyEx函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ke_yi_">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/ke_yi_head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KE_YI_">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/05/RegCreateKeyEx函数/" class="post-title-link" itemprop="url">RegCreateKeyEx函数</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-05 16:21:44" itemprop="dateCreated datePublished" datetime="2018-07-05T16:21:44+08:00">2018-07-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-09 15:40:33" itemprop="dateModified" datetime="2019-05-09T15:40:33+08:00">2019-05-09</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>   RegCreateKeyEx函数：创建指定的注册表项。如果键已经存在，函数将打开它。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**LONG RegCreateKeyEx( HKEY**_ [hKey]()_**, **// handle to open key ** LPCTSTR**_ [lpSubKey]()_**, **// subkey name ** DWORD**_ [Reserved]()_**, **// reserved ** LPTSTR**_ [lpClass]()_**, **// class string ** DWORD**_ [dwOptions]()_**, **// special options ** REGSAM**_ [samDesired]()_**, **// desired security access ** LPSECURITY_ATTRIBUTES**_ [lpSecurityAttributes]()_**,** // inheritance ** PHKEY**_ [phkResult]()_**, **// key handle ** LPDWORD**_ [lpdwDisposition]()_ ** ** // disposition value buffer **);**</span><br></pre></td></tr></table></figure>
<p>参数</p>
<p>hkey：当前打开的密钥或以下预定义密钥之一的句柄:  </p>
<p>HKEY_CLASSES_ROOT  </p>
<p>HKEY_CURRENT_CONFIG  </p>
<p>HKEY_CURRENT_USER  </p>
<p>HKEY_LOCAL_MACHINE  </p>
<p>HKEY_USERS  </p>
<p>Windows NT / 2000 / XP:HKEY_PERFORMANCE_DATA  </p>
<p>Windows 95/98 / Me:HKEY_DYN_DATA  </p>
<p>RegCreateKeyEx函数打开或创建的键是由hKey参数标识的键的子键。</p>
<p>lpSubKey：指向空终止字符串的指针，该字符串指定此函数打开或创建的子键的名称。指定的子键必须是由hKey参数标识的键的子键。这个参数不能为空。  </p>
<p>Windows NT/2000/XP: lpSubKey指定的子键名不能以反斜杠字符(‘\’)开头。如果是，则返回ERROR_BAD_PATHNAME。  </p>
<p>Windows 95/98/Me:忽略lpSubKey指定的子键名称中的开始反斜杠字符。</p>
<p>Reserved：保留;必须是零。</p>
<p>lpClass：指向空终止字符串的指针，该字符串指定此键的类(对象类型)。如果键已经存在，则忽略此参数。目前没有定义类;应用程序应该传递一个空字符串。Windows 95和Windows 98只对远程注册表键使用此参数;对于本地注册表项，它是被忽略的。对于本地和远程注册表键，Windows NT/Windows 2000都支持此参数。</p>
<p>dwOptions ：指定密钥的特殊选项。此参数可以是以下值之一。REG_OPTION_NON_VOLATILE、REG_OPTION_VOLATILE、REG_OPTION_BACKUP_RESTORE。  </p>
<p>samDesired ：一个访问掩码，它指定对密钥的期望访问权限。这个参数可以是以下值的组合。KEY_CREATE_LINK、KEY_CREATE_SUB_KEY、KEY_ENUMERATE_SUB_KEYS、KEY_EXECUTE、KEY_NOTIFY、KEY_QUERY_VALUE、KEY_SET_VALUE、KEY_ALL_ACCESS、KEY_READ、KEY_WOW64_64KEY、KEY_WOW64_32KEY、KEY_WRITE。</p>
<p>lpSecurityAttributes ：一个SECURITY_ATTRIBUTES结构的指针，该结构确定返回的句柄是否可以被子进程继承。如果lpSecurityAttributes为NULL，则不能继承该句柄。  </p>
<p>Windows NT/2000/XP:结构的lpSecurityDescriptor成员为新密钥指定了安全描述符。如果lpSecurityAttributes为空，则该键获得一个默认的安全描述符。<br>phkResult ：指向一个变量的指针，该变量接收以下配置值之一。REG_CREATED_NEW_KEY、REG_OPENED_EXISTING_KEY，</p>
<p>返回值  </p>
<p>如果函数成功，返回值为ERROR_SUCCESS。  </p>
<p>如果函数失败，返回值是Winerror.h中定义的非零错误代码。您可以使用FormatMessage函数和FORMAT_MESSAGE_FROM_SYSTEM标志来获得错误的通用描述。</p>
<p>示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;aclapi.h&gt;</span><br><span class="line"></span><br><span class="line">void main(int argc, char *argv[]) &#123;</span><br><span class="line"></span><br><span class="line">DWORD dwRes, dwDisposition;</span><br><span class="line">PSID pEveryoneSID = NULL, pAdminSID = NULL;</span><br><span class="line">PACL pACL = NULL;</span><br><span class="line">PSECURITY_DESCRIPTOR pSD = NULL;</span><br><span class="line">EXPLICIT_ACCESS ea[2];</span><br><span class="line">SID_IDENTIFIER_AUTHORITY SIDAuthWorld = SECURITY_WORLD_SID_AUTHORITY;</span><br><span class="line">SID_IDENTIFIER_AUTHORITY SIDAuthNT = SECURITY_NT_AUTHORITY;</span><br><span class="line">SECURITY_ATTRIBUTES sa;</span><br><span class="line">LONG lRes;</span><br><span class="line">HKEY hkSub = NULL;</span><br><span class="line"></span><br><span class="line">// Create a well-known SID for the Everyone group.</span><br><span class="line"></span><br><span class="line">if(! AllocateAndInitializeSid( &amp;SIDAuthWorld, 1,</span><br><span class="line">                 SECURITY_WORLD_RID,</span><br><span class="line">                 0, 0, 0, 0, 0, 0, 0,</span><br><span class="line">                 &amp;pEveryoneSID) ) &#123;</span><br><span class="line">    printf( &quot;AllocateAndInitializeSid Error %u\n&quot;, GetLastError() );</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Initialize an EXPLICIT_ACCESS structure for an ACE.</span><br><span class="line">// The ACE will allow Everyone read access to the key.</span><br><span class="line"></span><br><span class="line">ZeroMemory(&amp;ea, 2 * sizeof(EXPLICIT_ACCESS));</span><br><span class="line">ea[0].grfAccessPermissions = KEY_READ;</span><br><span class="line">ea[0].grfAccessMode = SET_ACCESS;</span><br><span class="line">ea[0].grfInheritance= NO_INHERITANCE;</span><br><span class="line">ea[0].Trustee.TrusteeForm = TRUSTEE_IS_SID;</span><br><span class="line">ea[0].Trustee.TrusteeType = TRUSTEE_IS_WELL_KNOWN_GROUP;</span><br><span class="line">ea[0].Trustee.ptstrName  = (LPTSTR) pEveryoneSID;</span><br><span class="line"></span><br><span class="line">// Create a SID for the BUILTIN\Administrators group.</span><br><span class="line"></span><br><span class="line">if(! AllocateAndInitializeSid( &amp;SIDAuthNT, 2,</span><br><span class="line">                 SECURITY_BUILTIN_DOMAIN_RID,</span><br><span class="line">                 DOMAIN_ALIAS_RID_ADMINS,</span><br><span class="line">                 0, 0, 0, 0, 0, 0,</span><br><span class="line">                 &amp;pAdminSID) ) &#123;</span><br><span class="line">    printf( &quot;AllocateAndInitializeSid Error %u\n&quot;, GetLastError() );</span><br><span class="line">    goto Cleanup; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Initialize an EXPLICIT_ACCESS structure for an ACE.</span><br><span class="line">// The ACE will allow the Administrators group full access to the key.</span><br><span class="line"></span><br><span class="line">ea[1].grfAccessPermissions = KEY_ALL_ACCESS;</span><br><span class="line">ea[1].grfAccessMode = SET_ACCESS;</span><br><span class="line">ea[1].grfInheritance= NO_INHERITANCE;</span><br><span class="line">ea[1].Trustee.TrusteeForm = TRUSTEE_IS_SID;</span><br><span class="line">ea[1].Trustee.TrusteeType = TRUSTEE_IS_GROUP;</span><br><span class="line">ea[1].Trustee.ptstrName  = (LPTSTR) pAdminSID;</span><br><span class="line"></span><br><span class="line">// Create a new ACL that contains the new ACEs.</span><br><span class="line"></span><br><span class="line">dwRes = SetEntriesInAcl(2, ea, NULL, &amp;pACL);</span><br><span class="line">if (ERROR_SUCCESS != dwRes) &#123;</span><br><span class="line">    printf( &quot;SetEntriesInAcl Error %u\n&quot;, GetLastError() );</span><br><span class="line">    goto Cleanup;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Initialize a security descriptor.  </span><br><span class="line"> </span><br><span class="line">pSD = (PSECURITY_DESCRIPTOR) LocalAlloc(LPTR, </span><br><span class="line">                         SECURITY_DESCRIPTOR_MIN_LENGTH); </span><br><span class="line">if (pSD == NULL) &#123; </span><br><span class="line">    printf( &quot;LocalAlloc Error %u\n&quot;, GetLastError() );</span><br><span class="line">    goto Cleanup; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">if (!InitializeSecurityDescriptor(pSD, SECURITY_DESCRIPTOR_REVISION)) &#123;  </span><br><span class="line">    printf( &quot;InitializeSecurityDescriptor Error %u\n&quot;, </span><br><span class="line">                            GetLastError() );</span><br><span class="line">    goto Cleanup; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">// Add the ACL to the security descriptor. </span><br><span class="line"> </span><br><span class="line">if (!SetSecurityDescriptorDacl(pSD, </span><br><span class="line">        TRUE,     // fDaclPresent flag   </span><br><span class="line">        pACL, </span><br><span class="line">        FALSE))   // not a default DACL </span><br><span class="line">&#123;  </span><br><span class="line">    printf( &quot;SetSecurityDescriptorDacl Error %u\n&quot;, GetLastError() );</span><br><span class="line">    goto Cleanup; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">// Initialize a security attributes structure.</span><br><span class="line"></span><br><span class="line">sa.nLength = sizeof (SECURITY_ATTRIBUTES);</span><br><span class="line">sa.lpSecurityDescriptor = pSD;</span><br><span class="line">sa.bInheritHandle = FALSE;</span><br><span class="line"></span><br><span class="line">// Use the security attributes to set the security descriptor </span><br><span class="line">// when you create a key.</span><br><span class="line"> </span><br><span class="line">lRes = RegCreateKeyEx(HKEY_CURRENT_USER, &quot;mykey&quot;, 0, &quot;&quot;, 0, </span><br><span class="line">        KEY_READ | KEY_WRITE, &amp;sa, &amp;hkSub, &amp;dwDisposition); </span><br><span class="line">printf( &quot;RegCreateKeyEx result %u\n&quot;, lRes );</span><br><span class="line"></span><br><span class="line">Cleanup:</span><br><span class="line"></span><br><span class="line">    if (pEveryoneSID) </span><br><span class="line">        FreeSid(pEveryoneSID);</span><br><span class="line">    if (pAdminSID) </span><br><span class="line">        FreeSid(pAdminSID);</span><br><span class="line">    if (pACL) </span><br><span class="line">        LocalFree(pACL);</span><br><span class="line">    if (pSD) </span><br><span class="line">        LocalFree(pSD);</span><br><span class="line">    if (hkSub) </span><br><span class="line">        RegCloseKey(hkSub);</span><br><span class="line">    return;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/ke_yi_head.jpg" alt="ke_yi_">
            
              <p class="site-author-name" itemprop="name">ke_yi_</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">85</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">0</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://github.com/zyipeng" title="GitHub &rarr; https://github.com/zyipeng" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="/ke_yi_zhou@163.com" title="E-Mail &rarr; ke_yi_zhou@163.com"><i class="fa fa-fw fa-envelope"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://blog.csdn.net/ke_yi_" title="Weibo &rarr; https://blog.csdn.net/ke_yi_" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i></a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ke_yi_</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.1.1</div>




        








        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.1"></script>

  <script src="/js/motion.js?v=7.1.1"></script>



  
  


  <script src="/js/affix.js?v=7.1.1"></script>

  <script src="/js/schemes/pisces.js?v=7.1.1"></script>



  

  


  <script src="/js/next-boot.js?v=7.1.1"></script>


  

  

  

  



  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
